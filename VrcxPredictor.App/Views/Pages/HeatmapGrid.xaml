<UserControl x:Class="VrcxPredictor.App.Views.Pages.HeatmapGrid"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <UserControl.Resources>
        <!-- Cell size switches with resolution -->
        <Style x:Key="HeatCellBorderStyle" TargetType="Border">
            <Setter Property="Width" Value="18"/>
            <Setter Property="Height" Value="18"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.HeatmapsVM.Hourly, RelativeSource={RelativeSource AncestorType=UserControl}}"
                             Value="False">
                    <Setter Property="Width" Value="10"/>
                    <Setter Property="Height" Value="10"/>
                    <Setter Property="CornerRadius" Value="3"/>
                    <Setter Property="Margin" Value="1.5"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <!-- Keep row header spacing aligned with cells -->
        <Style x:Key="HeatRowHeaderBorderStyle" TargetType="Border">
            <Setter Property="Height" Value="18"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.HeatmapsVM.Hourly, RelativeSource={RelativeSource AncestorType=UserControl}}"
                             Value="False">
                    <Setter Property="Height" Value="10"/>
                    <Setter Property="Margin" Value="1.5"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="68"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Row headers (fixed, non-scrolling) -->
        <ItemsControl Grid.Column="0" Margin="0,24,8,0" ItemsSource="{Binding HeatmapsVM.RowHeaders}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Style="{StaticResource HeatRowHeaderBorderStyle}" VerticalAlignment="Center">
                        <TextBlock Text="{Binding}" VerticalAlignment="Center" Opacity="0.85"/>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Matrix + column headers (scroll together) -->
        <ScrollViewer Grid.Column="1"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Disabled"
                      CanContentScroll="False">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Column headers -->
                <ItemsControl Grid.Row="0" ItemsSource="{Binding HeatmapsVM.ColHeaders}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Rows="1"
                                         Columns="{Binding DataContext.HeatmapsVM.ColHeaders.Count, RelativeSource={RelativeSource AncestorType=ItemsControl}}"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Height="22" Margin="2,0,2,2" Background="Transparent">
                                <TextBlock Text="{Binding}" FontSize="10" Opacity="0.7"
                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Cells -->
                <ItemsControl Grid.Row="1" ItemsSource="{Binding HeatmapsVM.Cells}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Rows="7"
                                         Columns="{Binding DataContext.HeatmapsVM.ColHeaders.Count, RelativeSource={RelativeSource AncestorType=ItemsControl}}"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource HeatCellBorderStyle}"
                                    Background="{Binding Brush}"
                                    ToolTip="{Binding Tooltip}"
                                    ToolTipService.InitialShowDelay="0"
                                    ToolTipService.Placement="Mouse" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
